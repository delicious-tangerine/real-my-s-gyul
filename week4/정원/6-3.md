# MySQL의 주요 처리 방식
설명하는 내용 중 "풀 테이블 스캔"을 제외한 나머지는 모두 스토리지 엔진이 아니라 MySQL 엔진에서 처리되는 내용이다. MySQL엔진에서 부가적으로 처리하는 작업은 대부분 성능에 미치는 영향력이 큰데, 모두 쿼리 성능을 저하시키는데 한몫하는 작업이다.

## 풀 테이블 스캔
인덱스를 사용하지 않고 테이블의 데이터를 처음부터 끝까지 읽어서 요청된 작업을 처리하는 작업 <br>
MySQL의 옵티마이저는 다음과 같은 조건에서 풀 테이블 스캔을 선택한다.
- 테이블의 레코드 건수가 너무 작아서 인덱스를 통해 읽는 것보다 풀 테이블 스캔이 더 빠른 경우
- WHERE 절이나 ON 절에 인덱스를 이용할 수 있는 적절한 조건이 없을 경우
- 인덱스 레인지 스캔을 사용할 수 있는 쿼리라 하더라도 옵티마이저의 판단한 조건 일치 레코드 건수가 너무 많은 경우

<br>
MySQL에서 한꺼번에 몇 개씩 페이지를 읽어올지 설정하는 변수는 없지만, 백 그라운드에서 처리되는 부분이 있으므로 상당히 빨리 처리 되는 편이다.

## ORDER BY 처리
인덱스를 이용하는 방법과 Filesort 라는 별도의 처리를 이용하는 방법이 있다.
||장점| 단점|
|--|--|--|
|인덱스|INSERT, UPDATE, DELETE 실행시 인덱스가 정렬돼 있어서 읽기가 빠름|INSERT, UPDATE, DELETE 작업시 부가적인 인덱스 추가/삭제 작업 때문에 느림, 공간이 더 많이 필요|
|Filesort|인덱스의 단점이 곧 장점|레코드 대상 건수가 많아질수록 응답 속도가 느림|

실행 계획의 Extra 칼럼에 "Using filesort" 라는 코멘트가 표시되는지 여부로 판단 할 수 있다.

### 소트 버퍼
- MySQL이 정렬을 수행하기 위해 할당 받는 별도의 공간.
- sort_buffer_size 라는 변수로 설정 가능
- 정렬 대상의 크기가 소트 버퍼 크기보다 큰 경우 디스크에 임시 저장을 한다.

![스크린샷 2021-06-21 오후 10 10 22](https://user-images.githubusercontent.com/41745717/122771877-ce90c200-d2e1-11eb-8da3-4707afb6db09.png)

## GROUP BY 처리
- 쿼리가 스트리밍된 처리를 할 수 없게 하는 요소 중 하나
- HAVING 절을 이용해 결과에 대해 필터링 역할 수행
- GROUP BY 에 사용된 조건은 인덱스를 사용해서 처리될 수 없으므로 튜닝하려고 인덱스를 생성하거나 다른 방법을 고민할 필요는 없다.

## DISTINCT 처리
특정 칼럼의 유니크한 값만을 조회 하기 위해 DISTINCT를 사용 한다.

### SELECT DISTINCT 
단순히 SELECT 되는 레코드 중에서 유니크한 레코드만 가져올 때 SELECT DISTINCT 형태의 쿼리 문장을 사용한다. GROUP BY와 거의 같은 방식으로 처리 되며, 단지 차이는 정렬이 보장되지 않는다는 것 뿐이다.

- SELECT DISTINCT first_name, last_name FROM employees;
- SELECT DISTINCT (first_name), last_name FROM employees;

위의 두 문장은 동일하게 처리 된다. first_name + last_name 의 조합이 유니크한 것을 가져옴.

### 집합 함수와 함께 사용된 DISTINCT
COUNT(), MIN(), MAX()와 같은 집합 함수내에서 DISTINCT가 사용될 수 있는데, 집합 함수의 인자로 전달된 칼럼 값들 중에서 중복을 제거하고 남은 값만을 가져온다.

## 임시 테이블
MySQL 엔진이 스토리지 엔진으로부터 받아온 레코드를 정렬하거나 그룹핑할 때는 내부적인 임시 테이블을 사용 한다.

- ORDER BY와 GROUP BY에 명시된 칼럼이 다른 쿼리
- ORDER BY나 GROUP BY에 명시된 칼럼이 조인의 순서상 첫 번째 테이블이 아닌 쿼리
- DISTINCT와 ORDER BY가 동시에 쿼리에 존재하는 경우 또는 DISTINCT가 인덱스로 처리되지 못하는 쿼리
- UNION이나 UNION DISTINCT가 사용된 쿼리

## 테이블 조인

### 이너 조인

### 아우터 조인

### 풀 조인


<br><br>

이너조인 과 아우터 조인은 저마다 용도가 다르므로 적절한 사용법을 익히고 요구되는 요건에 맞게 사용하는 것이 중요하다. <br>
이너 조인과 아우터 조인의 성능차이는 가져와야 하는 레코드의 수가 비슷 하다면 크게 나지 않는다. <br>
성능을 고려해서 선택할 것이 아니라 업무 요건에 따라 선택하는 것이 바람직하다.
