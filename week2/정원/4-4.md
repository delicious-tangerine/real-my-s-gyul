# InnoDB 스토리지 엔진의 잠금
InnoDB 스토리지 엔진은 MySQL에서 제공하는 잠금과는 별개로 스토리지 엔진 내부에서 레코드 기반의 잠금 방식을 탑재하고 있다.

## 잠금 방식
### Pessimistic Locking (InnoDB의 잠금 방식)
비관적 잠금, 트랜잭션 내에서 잠금을 획득 하는 것을 말하며, 이렇게 하지 않으면 다른 트랜잭션이 레코드를 변경 할 수 있다 라는 비관적인 생각을 가지고 잠금을 한다.

### Optimistic Locking
낙관적 잠금, 동시에 두 레코드 변경이 흔히 일어나지 않을것이라는 생각을 가지고 트랜잭션을 진행 한다. 완료 후 충돌이 있었는지 확인해 롤백 한다.

## InnoDB의 잠금 종류
### 레코드 락
레코드 자체만을 잠그는 것, InnoDB엔진은 레코드 자체가 아니라 인덱스의 레코드를 잠근다.

### 갭 락
레코드와 바로 인접한 레코드 사이의 간격만을 잠그는 것. 레코드와 레코드 사이에 새로운 레코드가 생성 되는 것을 방지

### 자동 증가 락
AUTO_INCREMENT 라는 컬럼 속성에 대해 걸리는 락. 증가치를 정확히 예측 할 수 있다면 이 락이 아니라 가벼운 뮤택스를 사용 할 수도 있다. (innodb_autoinc_lock_mode 변수를 조절)

## 인덱스와 잠금
InnoDB의 잠금은 레코드를 잠그는 것이 아니라 인덱스를 잠그는 방식으로 처리된다. 변경해야 할 레코드를 찾기 위해 검색한 인덱스의 레코드를 모두 잠가야 한다. 만약 인덱스가 하나도 없다면 풀 스캔하면서 모든 레코드를 잠그는 사태가 발생 하게 된다.

## 잠금 확인
```
SELECT * FROM information_schema.innodb_locks;
```
명령어를 통해 어떤 잠금을 기다리고 있는지, 기다리고 있는 잠금은 어떤 트랜잭션이 가지고 있는지를 쉽게 메타 정보를 통해 조회할 수 있다.