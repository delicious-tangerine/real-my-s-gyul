# `쿼리 성능 테스트`

## `쿼리의 성능에 영향을 미치는 요소`

- 직접 작성한 쿼리를 실행해보고 성능을 판단할 때 `가장 큰 변수`는 MysQL 서버가 가지고 있는 여러 종류의 `버퍼`, `캐시`일 것임

<br> <br>

### `운영체제의 캐시`

- MySQL 서버는 운영체제의 파일 시스템 관련 기능을 이용해 데이터 파일을 읽어온다. 

- 그런데 일반적으로 대부분의 운영체제는 한 번 읽은 데이터는 운영체제가 관리하는 별도의 캐시 영역에 보관해 뒀다가 다시 해당 데이터가 요청되면 디스크를 읽지 않고 캐시의 내용을 바로 MySQL 서버로 반환한다. 

- InnoDB 스토리지 엔진은 일반적으로 파일시스템의 캐시나 버퍼를 거치지 않는 Direct I/O를 사용하므로 운영체제의 캐시가 그다지 큰 영향을 미치지 않는다. 

<br> <br>

### `MySQL 서버의 버퍼 풀`

- InnoDB 스토리지 엔진이 관리하는 캐시를 버퍼 풀 이라고 함

- MySQL 서버에 포함된 키 캐시나 버퍼 풀을 초기화 하려면 MySQL 서버를 재시작 해야 함

- 쿼리 캐시를 사용하지 못하도록 힌트를 사용한 쿼리라 하더라도 처음 실행했을 때와 두 번째 실행행했을 때 상당한 성능 차이가 발생할 수도 있다. 

<br> <br>
 
### `MySQL 쿼리 캐시`

- 쿼리 캐시는 이전에 실행됏던 SQL 문장과 그 결과를 임시로 저장해두는 메모리 공간을 의미

- 만약 어떤 쿼리의 결과가 이미 쿼리 캐시에 있었다면 그 쿼리는 전체 실행 과정을 건너뛰기 때문에 실제 부하와 관계없이 아주 빠르게 처리될 것임

- 매번 쿼리 캐시를 비우기는 번거로우니까 쿼리에 `SQL_NO_CACHE` 힌트를 추가해서 쿼리의 성능을 테스트 하는 것이 좋다.

- 쿼리 테스트르를 하려면 번갈아 가면서 6~7번 정도 실행한 후, 처음 몇번의 결과는 버리고 나머지 결과의 평균 값을 기준으로 비교하는 것이 좋다. 

<br>
 