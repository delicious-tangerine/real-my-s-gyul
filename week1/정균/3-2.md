# `InnoDB 스토리지 엔진 아키텍쳐`

MySQL 엔진에서 가장 많이 사용되는 `InnoDB 엔진`에 대해서 정리

- InnoDB 엔진은 MySQL에서 사용할 수 있는 스토리지 엔진 중에서 거의 유일하게 `레코드 기반의 잠금`을 제공하고 있으며, 때문에 높은 동시성 처리가 가능하고 또한 안정적이며 성능이 뛰어나다. 

<br>

## `InnoDB 스토리지 엔진의 특성`

- 프라이머리 키에 의한 클러스터링
- 잠금이 필요 없는 일관된 읽기
- 외래 키 지원
- 자동 데드락 감지
- 자동화된 장애 복구

<br>

## `InnoDB 버퍼 풀`

- InnoDB 스토리지 엔진에서 가장 핵심적인 부분으로, 디스크의 데이터 파일이나 인덱스 정보를 메모리에 캐시해 두는 공간

- InnoDB의 버퍼 풀은 데이터와 인덱스 모두 캐시하고 쓰기 버퍼링의 역할까지 모두 처리 함

<br>

## `언두(Undo) 로그`

- `언두 영역`은 UPDATE, DELETE와 같이 데이터를 변경했을 때 변경되기 전의 데이터를 보관하는 곳

- 트랜잭션 롤백 대비용으로 활용
- 트랜잭션의 격리 수준을 유지하면서 높은 동시성을 제공하는 데 사용

<br>

## `인서트 버퍼(Insert Buffer)`

- INSERT, UPDATE 될 때 데이터 파일을 변경하는 작업 뿐 아니라 해당 테이블에 포함된 인덱스를 업데이트 하는 작업도 필요함

- 인덱스를 업데이트 하는 작업은 랜덤하게 디스크를 읽는 작업이 필요하므로 테이블에 인덱스가 많다면 이 작업은 상당히 많은 자원 소모

- InnoDB는 변경해야 할 인덱스 페이지가 버퍼 풀에 있으면 바로 업데이터, 그렇지 않고 디스크로부터 읽어와서 업데이트해야 한다면 이를 즉시 실행하지 않고 임시 공간에 저장해 두고 바로 결과 반환

- 이 때 사용하는 임시 메모리 공간을 인서트 버퍼(Insert Buffer)라고 함. 

<br>

## `리두(Redo) 로그 및 로그 버퍼`

- 쿼리 문장으로 데이터를 변경하고 커밋하면 DBMS는 데이터의 ACID를 보장하기 위해 즉시 변경된 데이터의 내용을 데이터 파일로 기록해야 함

- 하지만 데이터 파일 변경 작업은 랜덤하게 디스크에 기록해야 해서 부담이 크다. 

- 이러한 부하를 줄이기 위해 대부분의 DBMS에는 변경된 데이털르 버퍼링해 두기 위해 InnoDB 버퍼 풀이 존재

- 리두 로그 덕분에 DBMS 데이터는 버퍼링을 통해 한꺼번에 디스크에 변경된 내용을 처리할 수 있고 그로 인해 상당한 성능 향상을 기대할 수 있다. 

<br>

## `MVCC(Multi Version Concurrency Control)`

- 잠금을 사용하지 않는 일관된 읽기를 제공(InnoDB는 언두 로그를 이용해 이 기능을 구현)

<br>

## `잠금 없는 일관된 읽기`

- 특성 사용자가 레코드를 변경하고 아직 커밋을 수행하지 않았다 하더라도 이 변경 트랜잭션이 다른 사용자의 SELECT 작업을 방해하지 않는다. 이를 `잠금 없는 일관된 읽기` 라고 함
